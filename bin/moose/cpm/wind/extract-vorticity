#! /usr/bin/env bash

set -euo pipefail

job_id=0 # default to no job to wait on

while getopts ":j:" opt; do
  case ${opt} in
    j)
      job_id=${OPTARG}
      ;;
   \? )
     echo "Invalid Option: -${OPTARG}" 1>&2
     exit 1
     ;;
  esac
done
shift $((OPTIND -1))

ensemble_member=$1
theta=$2
shift 2
years=$@

SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

domain="birmingham"
scale_factor="gcm"
target_resolution="2.2km-coarsened-4x"
target_size=12
frequency="day"
variable="${SCRIPT_DIR}/../../../src/mlde_data/config/variables/${frequency}/land-cpm/vorticity${theta}.yml"

SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

QUEUE_DEP_PATH=${SCRIPT_DIR}/../../queue-dep-func
BATCH_WRAPPER_PATH=${SCRIPT_DIR}/../../batch-wrapper

echo
echo ${ensemble_member}
echo


job_id=$(${QUEUE_DEP_PATH} -j ${job_id} -d ${SCRIPT_DIR} -- ${BATCH_WRAPPER_PATH} --variable-config ${variable} --domain ${domain} --scale-factor ${scale_factor} --target-resolution ${target_resolution} --target-size ${target_size} --frequency ${frequency} --ensemble-member ${ensemble_member} ${years})
echo $job_id
